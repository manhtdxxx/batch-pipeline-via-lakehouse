# test_api.py

import numpy as np
import requests

# Endpoint API của bạn
url = "http://localhost:8000/predict"

# ---------------------------
# Tạo dummy data float64
# 2 sample, 10 timestep, 9 feature mỗi timestep
# ---------------------------
sample1 = np.array([
    [0.01, 0.5, 0.3, 0.2, 1, 0.05, 0.07, 0.6, 0.8],
    [0.02, 0.4, 0.2, 0.3, 0, 0.04, 0.06, 0.5, 0.7],
    [0.03, 0.3, 0.1, 0.4, 1, 0.03, 0.05, 0.4, 0.6],
    [0.04, 0.2, 0.2, 0.3, 0, 0.02, 0.04, 0.3, 0.5],
    [0.05, 0.1, 0.3, 0.2, 1, 0.01, 0.03, 0.2, 0.4],
    [0.06, 0.3, 0.1, 0.4, 0, 0.05, 0.07, 0.6, 0.8],
    [0.07, 0.4, 0.2, 0.3, 1, 0.06, 0.08, 0.7, 0.9],
    [0.08, 0.5, 0.3, 0.2, 0, 0.07, 0.09, 0.8, 1.0],
    [0.09, 0.6, 0.2, 0.1, 1, 0.08, 0.10, 0.9, 1.1],
    [0.10, 0.7, 0.3, 0.2, 0, 0.09, 0.11, 1.0, 1.2]
], dtype=np.float64)

sample2 = np.array([
    [0.05, 0.6, 0.2, 0.1, 0, 0.06, 0.08, 0.7, 0.9],
    [0.04, 0.5, 0.3, 0.2, 1, 0.05, 0.07, 0.6, 0.8],
    [0.03, 0.4, 0.2, 0.3, 0, 0.04, 0.06, 0.5, 0.7],
    [0.02, 0.3, 0.1, 0.4, 1, 0.03, 0.05, 0.4, 0.6],
    [0.01, 0.2, 0.2, 0.3, 0, 0.02, 0.04, 0.3, 0.5],
    [0.06, 0.3, 0.1, 0.4, 1, 0.05, 0.07, 0.6, 0.8],
    [0.07, 0.4, 0.2, 0.3, 0, 0.06, 0.08, 0.7, 0.9],
    [0.08, 0.5, 0.3, 0.2, 1, 0.07, 0.09, 0.8, 1.0],
    [0.09, 0.6, 0.2, 0.1, 0, 0.08, 0.10, 0.9, 1.1],
    [0.10, 0.7, 0.3, 0.2, 1, 0.09, 0.11, 1.0, 1.2]
], dtype=np.float64)

# ---------------------------
# Ép float64 trước khi gửi
# ---------------------------
payload = {
    "inputs": [sample1.astype(np.float64).tolist(),
               sample2.astype(np.float64).tolist()]
}

# ---------------------------
# Gửi POST request
# ---------------------------
response = requests.post(url, json=payload)

# In kết quả
print("Status code:", response.status_code)
try:
    print("Response JSON:", response.json())
except Exception:
    print("Response text:", response.text)
